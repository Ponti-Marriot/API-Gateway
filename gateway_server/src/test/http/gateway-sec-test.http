# https://www.keycloak.org/securing-apps/oidc-layers
@host = http://localhost:8080
@keycloak_host = http://localhost:9000
@user=admin1
@pass=admin123


### Get Keycloak configuration
GET http://localhost:9000/realms/myrealm/.well-known/openid-configuration

### Admin Login (direct)
# @name login
POST {{keycloak_host}}/realms/myrealm/protocol/openid-connect/token
Content-Type: application/x-www-form-urlencoded

grant_type=password&client_id=myapp&username={{user}}&password={{pass}}


### Admin Login
# @name login
@user=admin1
@pass=admin123
POST {{host}}/keycloak-server/realms/myrealm/protocol/openid-connect/token HTTP/1.1
Content-Type: application/x-www-form-urlencoded

grant_type=password&client_id=myapp&username={{user}}&password={{pass}}


### Refresh token
# @name login

@refresh_token = {{login.response.body.$.refresh_token}}
POST {{host}}/keycloak-server/realms/myrealm/protocol/openid-connect/token HTTP/1.1
Content-Type: application/x-www-form-urlencoded

grant_type=refresh_token&client_id=myapp&refresh_token={{refresh_token}}

### Request through Gateway
# The prefix `simple-microservice` must be the same as 
# the application name in application.yml of the microservice
@token = {{login.response.body.$.access_token}}

GET {{host}}/simple-microservice/simple/hola
Authorization: Bearer {{token}}